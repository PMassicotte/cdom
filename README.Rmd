---
bibliography: library.bib
output:
  md_document:
    variant: markdown_github
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

```{r setup, echo = FALSE}
library(ggplot2)
theme_set(theme_bw(base_size = 12, base_family = "Open Sans"))
```

# CDOM

The **cdom** package implements various functions used to model and calculate metrics from absorption spectra of chromophotic dissolved organic matter (CDOM). 

This package provides:

1. Simple wrappers to calculate commonly metrics found in the literature.
    + The **spectral curve** -- @Loiselle2009.
    + The **slope ratio (Sr)** -- @Helms2008.
    + The **spectral slope (S)** -- @Jerlov1968.

2. The function to use the **Gaussian decomposition approach** proposed in Massicotte and Markager, (2015).

The package can be installed using the following command.

```{r install, eval = FALSE}
devtools::install_github("PMassicotte/cdom")
```

Please note that this is a developing version of the package for testing only. Please fill an issue when you find bugs.

# Examples

## The spectral slope (S) by @Jerlov1968. 

The `fit_exponential()` function fits an exponential curve to CDOM data using the simple model proposed by Jerlov et al. (1968).

```tex
a(\lambda) = a(\lambda0)e^{-S(\lambda - \lambda0)} + K
```

```{r exponential}
library(cdom)
data("spectra")

fit <- fit_exponential(wl = spectra$wavelength,
                       spectra = spectra$absorbance,
                       wl0 = 350,
                       startwl = 190,
                       endwl = 900)

ggplot(spectra, aes(x = wavelength, y = absorbance)) +
  geom_point() +
  geom_line(aes(y = predict(fit)), col = "red") +
  xlab("Wavelength (nm)") +
  ylab(expression(paste("Absorbance (", m ^ {-1}, ")")))

```

## The slope ratio (SR) by @Helms2008.

The `slope_ratio()` function calculates the slope ratio (S<sub>R</sub>) which is defined as: S<sub>275-295</sub>/S<sub>350-400</sub>. See Helms et al. (2008) for details.

```{r sr}
library(cdom)
data("spectra")

slope_ratio(spectra$wavelength, spectra$absorbance)
```

## The spectral curve by @Loiselle2009.

The `spectral_curve()` function generates the spectral curve using the slope of the linear regression between the natural log absorption spectrum and wavelengths over a sliding windows of 21 nm interval (default) at 1 nm resolution.

```{r spectral_curve}
library(cdom)
data("spectra")

res <-  spectral_curve(spectra$wavelength, spectra$absorbance)

ggplot(res, aes(x = wl, y = s)) +
  geom_line() +
  xlab("Wavelength (nm)") +
  ylab(expression(paste("Spectral slope (", nm ^ {-1}, ")")))

```

# References
